graph TD
    subgraph A[Off-Chain - Platform Services & Frontend]
        Scanner[Merchant Validation App/Device]
        Indexer[Platform Data Indexer]
    end

    subgraph B[On-Chain - Solana Blockchain]
        NEP{NFT Extension Program - scan}
        NFT_M[NFT Mint - Existing]
    end

    User[User Wallet] -->|1. Present NFT| Scanner
    Scanner -->|2. Query NFT Status| Indexer
    Indexer -->|3. Return is_scanned Status| Scanner

    Scanner -->|4. Build Tx - is_scanned=true| NEP
    Merchant[Merchant Validation Key] -->|4. Sign Transaction| NEP

    NEP -->|5. On-Chain Check: Signer is Event Merchant| NEP
    NEP -->|6. CPI: Update Token-2022 Extension - is_scanned=true| NFT_M

    NEP -.->|7. Broadcast Tx Result| Solana_Net
    Solana_Net -->|8. Index Result - Status Updated| Indexer

    Indexer -->|9. Validation Success Feedback| Scanner